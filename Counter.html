<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="website-title-tag">Dynamic Counter Application</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            transition: background-color 0.3s ease;
        }
        .main-card {
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .modal {
            max-height: 90vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        .counter-card {
            background-color: #f9fafb;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
        }
        .counter-value {
            font-size: 3rem;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 1rem;
        }
        .counter-controls button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.5rem;
            font-weight: bold;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.2s ease;
        }
        .counter-name-input {
            width: 100%;
            padding: 0.5rem;
            border-radius: 0.5rem;
            border: 1px solid #d1d5db;
            margin-bottom: 0.75rem;
            text-align: center;
        }
        body.dark-mode {
            background-color: #1a202c;
        }
        body.dark-mode .main-card, body.dark-mode .modal > div {
            background-color: #2d3748;
            color: #e2e8f0;
        }
        body.dark-mode h1, body.dark-mode h2, body.dark-mode label {
            color: #e2e8f0;
        }
        body.dark-mode .counter-card {
            background-color: #4a5568;
        }
        body.dark-mode .counter-value {
            color: #e2e8f0;
        }
        body.dark-mode .counter-name-input {
            background-color: #2d3748;
            border-color: #616e80;
            color: #e2e8f0;
        }
        body.dark-mode .text-gray-700 {
            color: #e2e8f0;
        }
        body.dark-mode .text-gray-600 {
            color: #cbd5e0;
        }
        body.dark-mode .fixed.bg-white {
            background-color: #2d3748;
        }
        .text-custom-sm .counter-card h3 { font-size: 1.125rem; }
        .text-custom-sm .counter-value { font-size: 2.5rem; }
        .text-custom-base .counter-card h3 { font-size: 1.25rem; }
        .text-custom-base .counter-value { font-size: 3rem; }
        .text-custom-lg .counter-card h3 { font-size: 1.5rem; }
        .text-custom-lg .counter-value { font-size: 3.5rem; }
        .text-custom-xl .counter-card h3 { font-size: 1.75rem; }
        .text-custom-xl .counter-value { font-size: 4rem; }

    </style>
</head>
<body>
    <div class="fixed top-4 left-4 z-50">
        <button id="go-home-btn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors duration-300 shadow-md focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-opacity-75 text-sm md:text-base">
            Go back to home
        </button>
    </div>

    <div class="fixed top-4 right-4 z-50 flex items-center space-x-2 bg-white rounded-full py-2 px-4 shadow-md transition-colors duration-300">
        <span id="user-name-display" class="text-lg font-medium text-blue-600">Guest</span>
        <button id="edit-name-btn" class="text-gray-500 hover:text-gray-700 transition-colors duration-200 focus:outline-none">
            <i class="fas fa-pencil-alt text-base"></i>
        </button>
    </div>

    <div class="fixed top-16 left-4 z-50">
        <button id="configure-display-btn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors duration-300 shadow-md focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-opacity-75 text-sm md:text-base">
            <i class="fas fa-palette mr-2"></i>Configure Display
        </button>
    </div>

    <div id="main-content-card" class="w-full max-w-4xl bg-white shadow-lg rounded-2xl p-8 text-center main-card">
        <h1 class="text-4xl font-bold text-gray-800 mb-6" id="website-main-title">Dynamic Counter</h1>
        <div id="counters-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
        </div>

        <div class="flex justify-between items-center mb-8">
            <button id="prev-page-btn" class="px-6 py-3 bg-blue-600 text-white font-bold rounded-xl hover:bg-blue-700 transition-all duration-300 shadow-lg transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75">
                <i class="fas fa-arrow-left mr-2"></i>Previous Page
            </button>
            <span id="page-info" class="text-xl font-semibold text-gray-700">Page 1 of 1</span>
            <button id="next-page-btn" class="px-6 py-3 bg-blue-600 text-white font-bold rounded-xl hover:bg-blue-700 transition-all duration-300 shadow-lg transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75">
                Next Page<i class="fas fa-arrow-right ml-2"></i>
            </button>
        </div>

        <div class="flex flex-col md:flex-row justify-center space-y-4 md:space-y-0 md:space-x-4">
            <button id="add-counter-btn"
                    class="flex-1 px-8 py-4 bg-green-600 text-white font-bold text-xl rounded-xl hover:bg-green-700 transition-all duration-300 shadow-lg transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-75">
                Add New Counter
            </button>
            <button id="counter-app-settings-btn"
                    class="flex-1 px-8 py-4 bg-purple-600 text-white font-bold text-xl rounded-xl hover:bg-purple-700 transition-all duration-300 shadow-lg transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-opacity-75">
                Counter App Settings
            </button>
        </div>
    </div>

    <div id="name-edit-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md transform transition-all duration-300 scale-100 opacity-100">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Change Your Name</h2>
            <div class="mb-6">
                <label for="name-edit-user-input" class="block text-gray-700 text-sm font-semibold mb-2">Your Name:</label>
                <input type="text" id="name-edit-user-input" placeholder="Enter your name"
                       class="shadow-sm appearance-none border rounded-xl w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-200">
            </div>
            <button id="save-name-only-btn"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75 transition-all duration-300 shadow-lg">Save Name</button>
        </div>
    </div>

    <div id="configure-counter-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md transform transition-all duration-300 scale-100 opacity-100">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center" id="configure-counter-modal-title">Configure Counter</h2>
            <div class="mb-4">
                <label for="counter-name-input" class="block text-gray-700 text-sm font-semibold mb-2">Counter Name:</label>
                <input type="text" id="counter-name-input" placeholder="e.g. My Daily Steps"
                       class="shadow-sm appearance-none border rounded-xl w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-200">
            </div>
            <div class="mb-6">
                <label for="counter-value-input" class="block text-gray-700 text-sm font-semibold mb-2">Initial Value:</label>
                <input type="number" id="counter-value-input" value="0"
                       class="shadow-sm appearance-none border rounded-xl w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-200">
            </div>
            <div class="flex justify-between space-x-4">
                <button id="save-counter-btn"
                             class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75 transition-all duration-300 shadow-lg">Save Counter</button>
                <button id="delete-counter-btn"
                             class="flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-xl focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-75 transition-all duration-300 shadow-lg hidden">Delete Counter</button>
            </div>
        </div>
    </div>

    <div id="display-settings-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md transform transition-all duration-300 scale-100 opacity-100">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Display Settings</h2>

            <div class="mb-6">
                <label class="block text-gray-700 text-sm font-semibold mb-2">Theme:</label>
                <div class="flex flex-col space-y-2">
                    <label class="inline-flex items-center">
                        <input type="radio" name="theme" value="light" class="form-radio text-blue-600" checked>
                        <span class="ml-2 text-gray-700">Light Mode</span>
                    </label>
                    <label class="inline-flex items-center">
                        <input type="radio" name="theme" value="dark" class="form-radio text-blue-600">
                        <span class="ml-2 text-gray-700">Dark Mode</span>
                    </label>
                    <label class="inline-flex items-center">
                        <input type="radio" name="theme" value="custom" class="form-radio text-blue-600">
                        <span class="ml-2 text-gray-700">Custom Colors</span>
                    </label>
                </div>
            </div>

            <div id="custom-color-inputs" class="space-y-4 mb-6 hidden">
                <div>
                    <label for="custom-body-bg-color" class="block text-gray-700 text-sm font-semibold mb-2">Body Background Color:</label>
                    <input type="color" id="custom-body-bg-color" value="#f3f4f6"
                           class="w-full h-10 border rounded-lg p-1">
                </div>
                <div>
                    <label for="custom-card-bg-color" class="block text-gray-700 text-sm font-semibold mb-2">Card Background Color:</label>
                    <input type="color" id="custom-card-bg-color" value="#ffffff"
                           class="w-full h-10 border rounded-lg p-1">
                </div>
            </div>

            <div class="mb-6">
                <label for="text-size-select" class="block text-gray-700 text-sm font-semibold mb-2">Text Size:</label>
                <select id="text-size-select" class="shadow-sm appearance-none border rounded-xl w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-200">
                    <option value="text-custom-sm">Small</option>
                    <option value="text-custom-base" selected>Normal</option>
                    <option value="text-custom-lg">Large</option>
                    <option value="text-custom-xl">Extra Large</option>
                </select>
            </div>

            <button id="save-display-settings-btn"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75 transition-all duration-300 shadow-lg">Save Display Settings</button>
        </div>
    </div>

    <div id="counter-app-settings-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md transform transition-all duration-300 scale-100 opacity-100">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Counter App Settings</h2>

            <div class="mb-6">
                <label for="counters-per-page-input" class="block text-gray-700 text-sm font-semibold mb-2">Counters Per Page:</label>
                <input type="number" id="counters-per-page-input" value="6" min="1"
                       class="shadow-sm appearance-none border rounded-xl w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-200">
            </div>

            <div class="mb-6">
                <label for="website-title-input" class="block text-gray-700 text-sm font-semibold mb-2">Website Tab Title:</label>
                <input type="text" id="website-title-input" placeholder="e.g. My Cool App"
                       class="shadow-sm appearance-none border rounded-xl w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-200">
            </div>

            <div class="mb-6">
                <label for="website-main-title-input" class="block text-gray-700 text-sm font-semibold mb-2">Main Display Title:</label>
                <input type="text" id="website-main-title-input" placeholder="e.g. My Counter Dashboard"
                       class="shadow-sm appearance-none border rounded-xl w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent transition-all duration-200">
            </div>

            <button id="save-counter-app-settings-btn"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75 transition-all duration-300 shadow-lg">Save Settings</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const goHomeBtn = document.getElementById('go-home-btn');
            const userNameDisplay = document.getElementById('user-name-display');
            const editNameBtn = document.getElementById('edit-name-btn');
            const configureDisplayBtn = document.getElementById('configure-display-btn');
            const mainContentCard = document.getElementById('main-content-card');
            const websiteMainTitle = document.getElementById('website-main-title');
            // const pageTitle = document.getElementById('page-title'); // This element has been removed
            const countersGrid = document.getElementById('counters-grid');
            const addCounterBtn = document.getElementById('add-counter-btn');
            const prevPageBtn = document.getElementById('prev-page-btn');
            const nextPageBtn = document.getElementById('next-page-btn');
            const pageInfo = document.getElementById('page-info');
            const counterAppSettingsBtn = document.getElementById('counter-app-settings-btn');

            const nameEditModal = document.getElementById('name-edit-modal');
            const nameEditUserInput = document.getElementById('name-edit-user-input');
            const saveNameOnlyBtn = document.getElementById('save-name-only-btn');

            const configureCounterModal = document.getElementById('configure-counter-modal');
            const configureCounterModalTitle = document.getElementById('configure-counter-modal-title');
            const counterNameInput = document.getElementById('counter-name-input');
            const counterValueInput = document.getElementById('counter-value-input');
            const saveCounterBtn = document.getElementById('save-counter-btn');
            const deleteCounterBtn = document.getElementById('delete-counter-btn');

            const displaySettingsModal = document.getElementById('display-settings-modal');
            const themeRadios = document.querySelectorAll('input[name="theme"]');
            const customColorInputsDiv = document.getElementById('custom-color-inputs');
            const customBodyBgColorInput = document.getElementById('custom-body-bg-color');
            const customCardBgColorInput = document.getElementById('custom-card-bg-color');
            const textSizeSelect = document.getElementById('text-size-select');
            const saveDisplaySettingsBtn = document.getElementById('save-display-settings-btn');

            const counterAppSettingsModal = document.getElementById('counter-app-settings-modal');
            const countersPerPageInput = document.getElementById('counters-per-page-input');
            const websiteTitleInput = document.getElementById('website-title-input');
            const websiteMainTitleInput = document.getElementById('website-main-title-input');
            const saveCounterAppSettingsBtn = document.getElementById('save-counter-app-settings-btn');
            const websiteTitleTag = document.getElementById('website-title-tag');


            let appState = {
                userName: '',
                websiteTitle: 'Dynamic Counter Application',
                websiteMainTitleText: 'Dynamic Counter', // Initial value for the big title
                displaySettings: {
                    theme: 'light',
                    customBodyBg: '#f3f4f6',
                    customCardBg: '#ffffff',
                    textSize: 'text-custom-base'
                },
                counters: [],
                currentPage: 1,
                countersPerPage: 6
            };

            let currentEditingCounterId = null;

            const setCookie = (name, value, days) => {
                let expires = '';
                if (days) {
                    const date = new Date();
                    date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                    expires = '; expires=' + date.toUTCString();
                }
                document.cookie = name + '=' + (value || '') + expires + '; path=/; SameSite=Lax';
            };

            const getCookie = (name) => {
                const nameEQ = name + '=';
                const ca = document.cookie.split(';');
                for (let i = 0; i < ca.length; i++) {
                    let c = ca[i];
                    while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                    if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
                }
                return null;
            };

            const deleteCookie = (name) => {
                document.cookie = name + '=; Max-Age=-99999999; path=/; SameSite=Lax';
            };

            const saveAppState = () => {
                setCookie('appState', JSON.stringify(appState), 365);
            };

            const loadAppState = () => {
                const storedState = getCookie('appState');
                if (storedState) {
                    try {
                        const parsedState = JSON.parse(storedState);
                        // Merge with default state to ensure new properties are included
                        appState = { ...appState, ...parsedState };

                        // Apply loaded settings immediately
                        userNameDisplay.textContent = appState.userName || 'Guest';
                        websiteTitleTag.textContent = appState.websiteTitle;
                        websiteMainTitle.textContent = appState.websiteMainTitleText; // Load and apply main title

                        // Update input fields in settings modals
                        websiteTitleInput.value = appState.websiteTitle;
                        websiteMainTitleInput.value = appState.websiteMainTitleText;
                        countersPerPageInput.value = appState.countersPerPage;

                    } catch (e) {
                        console.error("Error parsing appState from cookie:", e);
                        // Optionally reset cookie if it's corrupted
                        deleteCookie('appState');
                    }
                }
            };

            const applyDisplaySettings = () => {
                const { theme, customBodyBg, customCardBg, textSize } = appState.displaySettings;

                const textSizes = ['text-custom-sm', 'text-custom-base', 'text-custom-lg', 'text-custom-xl'];
                textSizes.forEach(cls => {
                    mainContentCard.classList.remove(cls);
                    countersGrid.classList.remove(cls); // Ensure counters grid also removes old text size classes
                });
                mainContentCard.classList.add(textSize);
                // Also apply text size to individual counter cards for consistency if needed,
                // or ensure your CSS .counter-card h3 and .counter-value rules are scoped correctly
                // or add it to the counters grid which contains them.
                countersGrid.classList.add(textSize);


                document.body.classList.remove('bg-gray-100', 'dark-mode');
                document.body.style.backgroundColor = '';
                document.body.style.backgroundImage = '';

                mainContentCard.classList.remove('bg-white', 'bg-gray-800');
                mainContentCard.style.backgroundColor = '';

                websiteMainTitle.style.color = '';
                // pageTitle.style.color = ''; // Removed as pageTitle element is gone
                pageInfo.style.color = '';

                document.querySelectorAll('.counter-card h3').forEach(el => el.style.color = '');
                document.querySelectorAll('.counter-value').forEach(el => el.style.color = '');
                document.querySelectorAll('.counter-card').forEach(card => card.style.backgroundColor = ''); // Reset card background


                const userNameBox = document.querySelector('.fixed.top-4.right-4');
                userNameBox.classList.remove('bg-white', 'bg-gray-900');
                userNameBox.querySelector('span').style.color = '';
                userNameBox.querySelector('button').style.color = '';

                if (theme === 'dark') {
                    document.body.classList.add('dark-mode');
                    document.body.style.backgroundImage = 'url("https://placehold.co/1920x1080/2d3748/2d3748?text=")';
                    document.body.style.backgroundColor = '#1a202c';

                    mainContentCard.classList.add('bg-gray-800');
                    websiteMainTitle.style.color = '#e2e8f0';
                    // pageTitle.style.color = '#cbd5e0'; // Removed
                    pageInfo.style.color = '#e2e8f0';

                    document.querySelectorAll('.counter-card h3').forEach(el => el.style.color = '#e2e8f0');
                    document.querySelectorAll('.counter-value').forEach(el => el.style.color = '#e2e8f0');
                    document.querySelectorAll('.counter-card').forEach(card => card.style.backgroundColor = '#4a5568');


                    userNameBox.classList.add('bg-gray-900');
                    userNameBox.querySelector('span').style.color = '#90cdf4';
                    userNameBox.querySelector('button').style.color = '#a0aec0';

                } else if (theme === 'custom') {
                    document.body.style.backgroundColor = customBodyBg;
                    document.body.style.backgroundImage = 'none';

                    mainContentCard.style.backgroundColor = customCardBg;

                    const isDark = (color) => {
                        if (!color) return false;
                        const rgb = parseInt(color.replace('#', ''), 16);
                        const r = (rgb >> 16) & 0xff;
                        const g = (rgb >> 8) & 0xff;
                        const b = (rgb >> 0) & 0xff;
                        return (0.2126 * r + 0.7152 * g + 0.0722 * b) < 128;
                    };

                    // Determine text color based on background luminance
                    const bodyTextColor = isDark(customBodyBg) ? '#e2e8f0' : '#1a202c';
                    websiteMainTitle.style.color = bodyTextColor;
                    // pageTitle.style.color = isDark(customBodyBg) ? '#cbd5e0' : '#4a5568'; // Removed
                    pageInfo.style.color = isDark(customBodyBg) ? '#e2e8f0' : '#4a5568';

                    // Update username box colors based on body background
                    if (isDark(customBodyBg)) {
                        userNameBox.classList.add('bg-gray-900');
                        userNameBox.querySelector('span').style.color = '#90cdf4';
                        userNameBox.querySelector('button').style.color = '#a0aec0';
                    } else {
                        userNameBox.classList.add('bg-white');
                        userNameBox.querySelector('span').style.color = '#3182ce';
                        userNameBox.querySelector('button').style.color = '#a0aec0';
                    }

                    // Update counter card text and background colors based on customCardBg
                    const cardTextColor = isDark(customCardBg) ? '#e2e8f0' : '#1f2937';
                    const cardBgColor = customCardBg;

                    document.querySelectorAll('.counter-card h3').forEach(el => el.style.color = cardTextColor);
                    document.querySelectorAll('.counter-value').forEach(el => el.style.color = cardTextColor);
                    document.querySelectorAll('.counter-card').forEach(card => card.style.backgroundColor = cardBgColor);

                } else {
                    document.body.classList.add('bg-gray-100');
                    document.body.style.backgroundImage = 'url("https://placehold.co/1920x1080/e5e7eb/e5e7eb?text=")';
                    mainContentCard.classList.add('bg-white');
                    userNameBox.classList.add('bg-white');
                }
            };

            const renderUserName = () => {
                userNameDisplay.textContent = appState.userName || 'Guest';
                if (!appState.userName && !sessionStorage.getItem('nameEditModalShown')) {
                    nameEditUserInput.value = appState.userName;
                    nameEditModal.classList.remove('hidden');
                    sessionStorage.setItem('nameEditModalShown', 'true');
                } else if (appState.userName) {
                    nameEditModal.classList.add('hidden');
                }
            };

            const renderCounters = () => {
                countersGrid.innerHTML = '';
                const startIndex = (appState.currentPage - 1) * appState.countersPerPage;
                const endIndex = Math.min(startIndex + appState.countersPerPage, appState.counters.length);

                const countersToRender = appState.counters.slice(startIndex, endIndex);

                if (countersToRender.length === 0 && appState.currentPage > 1) {
                    appState.currentPage--;
                    saveAppState();
                    renderCounters();
                    return;
                }

                countersToRender.forEach((counter) => {
                    const counterCard = document.createElement('div');
                    counterCard.className = 'counter-card';
                    counterCard.innerHTML = `
                        <h3 class="text-xl font-semibold mb-2">${counter.name}</h3>
                        <div class="counter-value">${counter.value}</div>
                        <div class="counter-controls flex space-x-2">
                            <button class="bg-red-500 text-white hover:bg-red-600 decrement-btn" data-id="${counter.id}">-</button>
                            <button class="bg-blue-500 text-white hover:bg-blue-600 edit-counter-btn" data-id="${counter.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="bg-green-500 text-white hover:bg-green-600 increment-btn" data-id="${counter.id}">+</button>
                        </div>
                    `;
                    countersGrid.appendChild(counterCard);
                });

                const totalPages = Math.max(1, Math.ceil(appState.counters.length / appState.countersPerPage));
                pageInfo.textContent = `Page ${appState.currentPage} of ${totalPages}`;

                prevPageBtn.disabled = appState.currentPage === 1;
                nextPageBtn.disabled = appState.currentPage === totalPages;

                applyDisplaySettings(); // Re-apply settings after rendering counters to ensure colors are correct
            };

            const incrementCounter = (id) => {
                const index = appState.counters.findIndex(c => c.id === id);
                if (index !== -1) {
                    appState.counters[index].value++;
                    saveAppState();
                    renderCounters();
                }
            };

            const decrementCounter = (id) => {
                const index = appState.counters.findIndex(c => c.id === id);
                if (index !== -1) {
                    appState.counters[index].value--;
                    saveAppState();
                    renderCounters();
                }
            };

            const addOrUpdateCounter = () => {
                const name = counterNameInput.value.trim();
                const value = parseInt(counterValueInput.value);

                if (!name) {
                    alert('Counter name cannot be empty.');
                    return;
                }
                if (isNaN(value)) {
                    alert('Please enter a valid number for the initial value.');
                    return;
                }

                if (currentEditingCounterId === null) {
                    const totalCountersOnCurrentPage = appState.counters.slice((appState.currentPage - 1) * appState.countersPerPage, appState.currentPage * appState.countersPerPage).length;
                    if (totalCountersOnCurrentPage >= appState.countersPerPage) {
                        appState.currentPage++;
                    }
                    appState.counters.push({ id: Date.now(), name, value });
                } else {
                    const index = appState.counters.findIndex(c => c.id === currentEditingCounterId);
                    if (index !== -1) {
                        appState.counters[index].name = name;
                        appState.counters[index].value = value;
                    }
                }
                saveAppState();
                configureCounterModal.classList.add('hidden');
                renderCounters();
            };

            const deleteCounter = () => {
                if (currentEditingCounterId !== null && confirm('Are you sure you want to delete this counter?')) {
                    const index = appState.counters.findIndex(c => c.id === currentEditingCounterId);
                    if (index !== -1) {
                        appState.counters.splice(index, 1);
                        saveAppState();
                        configureCounterModal.classList.add('hidden');
                        renderCounters();
                    }
                }
            };

            goHomeBtn.addEventListener('click', () => {
                window.location.href = 'https://vugbigeriuerr3.github.io/github.io/?' + new Date().getTime();
            });

            saveNameOnlyBtn.addEventListener('click', () => {
                const newUserName = nameEditUserInput.value.trim();
                if (newUserName) {
                    appState.userName = newUserName;
                    saveAppState();
                    renderUserName();
                    nameEditModal.classList.add('hidden');
                } else {
                    alert('Please enter a name.');
                }
            });

            editNameBtn.addEventListener('click', () => {
                nameEditUserInput.value = appState.userName;
                nameEditModal.classList.remove('hidden');
                sessionStorage.removeItem('nameEditModalShown'); // Allow modal to show again if name is cleared
            });

            nameEditModal.addEventListener('click', (e) => {
                if (e.target === nameEditModal) {
                    nameEditModal.classList.add('hidden');
                }
            });


            addCounterBtn.addEventListener('click', () => {
                currentEditingCounterId = null;
                configureCounterModalTitle.textContent = 'Add New Counter';
                counterNameInput.value = '';
                counterValueInput.value = 0;
                deleteCounterBtn.classList.add('hidden');
                configureCounterModal.classList.remove('hidden');
            });

            saveCounterBtn.addEventListener('click', addOrUpdateCounter);
            deleteCounterBtn.addEventListener('click', deleteCounter);

            configureCounterModal.addEventListener('click', (e) => {
                if (e.target === configureCounterModal) {
                    configureCounterModal.classList.add('hidden');
                }
            });

            countersGrid.addEventListener('click', (e) => {
                if (e.target.classList.contains('increment-btn')) {
                    const id = parseInt(e.target.dataset.id);
                    incrementCounter(id);
                } else if (e.target.classList.contains('decrement-btn')) {
                    const id = parseInt(e.target.dataset.id);
                    decrementCounter(id);
                } else if (e.target.classList.contains('edit-counter-btn') || e.target.closest('.edit-counter-btn')) {
                    const btn = e.target.classList.contains('edit-counter-btn') ? e.target : e.target.closest('.edit-counter-btn');
                    const id = parseInt(btn.dataset.id);
                    currentEditingCounterId = id;
                    const counter = appState.counters.find(c => c.id === id);
                    if (counter) {
                        configureCounterModalTitle.textContent = `Edit Counter: ${counter.name}`;
                        counterNameInput.value = counter.name;
                        counterValueInput.value = counter.value;
                        deleteCounterBtn.classList.remove('hidden');
                        configureCounterModal.classList.remove('hidden');
                    }
                }
            });

            prevPageBtn.addEventListener('click', () => {
                if (appState.currentPage > 1) {
                    appState.currentPage--;
                    saveAppState();
                    renderCounters();
                }
            });

            nextPageBtn.addEventListener('click', () => {
                const totalPages = Math.max(1, Math.ceil(appState.counters.length / appState.countersPerPage));
                if (appState.currentPage < totalPages) {
                    appState.currentPage++;
                    saveAppState();
                    renderCounters();
                }
            });

            configureDisplayBtn.addEventListener('click', () => {
                // Set radio buttons based on current theme
                themeRadios.forEach(radio => {
                    radio.checked = radio.value === appState.displaySettings.theme;
                });

                // Show/hide custom color inputs
                customColorInputsDiv.classList.toggle('hidden', appState.displaySettings.theme !== 'custom');
                customBodyBgColorInput.value = appState.displaySettings.customBodyBg;
                customCardBgColorInput.value = appState.displaySettings.customCardBg;

                // Set text size select
                textSizeSelect.value = appState.displaySettings.textSize;

                displaySettingsModal.classList.remove('hidden');
            });

            themeRadios.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    customColorInputsDiv.classList.toggle('hidden', e.target.value !== 'custom');
                });
            });

            saveDisplaySettingsBtn.addEventListener('click', () => {
                appState.displaySettings.theme = document.querySelector('input[name="theme"]:checked').value;
                appState.displaySettings.customBodyBg = customBodyBgColorInput.value;
                appState.displaySettings.customCardBg = customCardBgColorInput.value;
                appState.displaySettings.textSize = textSizeSelect.value;
                saveAppState();
                applyDisplaySettings();
                displaySettingsModal.classList.add('hidden');
            });

            displaySettingsModal.addEventListener('click', (e) => {
                if (e.target === displaySettingsModal) {
                    displaySettingsModal.classList.add('hidden');
                }
            });


            counterAppSettingsBtn.addEventListener('click', () => {
                countersPerPageInput.value = appState.countersPerPage;
                websiteTitleInput.value = appState.websiteTitle;
                websiteMainTitleInput.value = appState.websiteMainTitleText; // Populate input with current main title
                counterAppSettingsModal.classList.remove('hidden');
            });

            saveCounterAppSettingsBtn.addEventListener('click', () => {
                const newCountersPerPage = parseInt(countersPerPageInput.value);
                if (!isNaN(newCountersPerPage) && newCountersPerPage > 0) {
                    appState.countersPerPage = newCountersPerPage;
                } else {
                    alert('Please enter a valid number for counters per page (must be greater than 0).');
                    countersPerPageInput.value = appState.countersPerPage; // Reset to old value
                }

                appState.websiteTitle = websiteTitleInput.value.trim();
                websiteTitleTag.textContent = appState.websiteTitle;

                appState.websiteMainTitleText = websiteMainTitleInput.value.trim(); // Update appState
                websiteMainTitle.textContent = appState.websiteMainTitleText; // Update the displayed H1

                saveAppState();
                renderCounters(); // Re-render counters to apply new items per page, and potentially new page layout
                counterAppSettingsModal.classList.add('hidden');
            });

            counterAppSettingsModal.addEventListener('click', (e) => {
                if (e.target === counterAppSettingsModal) {
                    counterAppSettingsModal.classList.add('hidden');
                }
            });


            // Initial load and render
            loadAppState();
            renderUserName();
            renderCounters();
        });
    </script>
</body>
</html>
